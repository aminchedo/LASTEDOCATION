import{c as k,j as e,D as N,B as c,a0 as L,b as u,v as z,G as p,L as D,e as U,l as B,a4 as d}from"./index-Br5p3c61.js";import{b as i}from"./react-vendor-CHIk2tMd.js";import{S as F}from"./Select-DwYsi9Sj.js";import{P as M}from"./Progress-48by0XhX.js";import{u as P}from"./useAILab-Cx0UAcfI.js";import"./api-BM4dxxsF.js";import"./auth.service-DTA6mi50.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=k("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);function G(){const{datasets:b,uploadDataset:w}=P(),t=i.useRef(null),[j,o]=i.useState(0),[f,v]=i.useState(!1),[m,C]=i.useState(""),[a,r]=i.useState({name:"",type:"text",description:""}),S=async s=>{const l=s.target.files?.[0];if(!l)return;const h=[".csv",".json",".txt",".jsonl"],x=l.name.substring(l.name.lastIndexOf(".")).toLowerCase();if(!h.includes(x)){d.error("فرمت فایل پشتیبانی نمی‌شود. لطفاً فایل CSV، JSON، JSONL یا TXT آپلود کنید.");return}r(x===".csv"?n=>({...n,type:"structured"}):x===".json"||x===".jsonl"?n=>({...n,type:"structured"}):n=>({...n,type:"text"})),a.name||r(n=>({...n,name:l.name.substring(0,l.name.lastIndexOf("."))}))},I=async()=>{const s=t.current?.files?.[0];if(!s){d.error("لطفاً یک فایل انتخاب کنید");return}if(!a.name){d.error("لطفاً نام دیتاست را وارد کنید");return}v(!0),o(0);try{const l=setInterval(()=>{o(h=>Math.min(h+10,90))},200);await w(s,a),clearInterval(l),o(100),r({name:"",type:"text",description:""}),t.current&&(t.current.value=""),d.success("دیتاست با موفقیت آپلود شد")}catch(l){console.error("Upload failed:",l)}finally{v(!1),o(0)}},g=b.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase())),y=s=>s<1024?s+" B":s<1048576?Math.round(s/1024)+" KB":Math.round(s/1048576)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-[color:var(--c-primary)]"}),"مدیریت دیتاست‌ها"]}),e.jsx(c,{variant:"primary",icon:e.jsx(L,{className:"w-4 h-4"}),onClick:()=>t.current?.click(),children:"آپلود دیتاست جدید"})]}),t.current?.files?.length?e.jsxs(u,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"آپلود دیتاست"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"فایل انتخاب شده"}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[color:var(--c-bg-elevated)] rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 text-[color:var(--c-text-secondary)]"}),e.jsx("span",{children:t.current.files[0].name}),e.jsxs("span",{className:"text-sm text-[color:var(--c-text-secondary)]",children:["(",y(t.current.files[0].size),")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نام دیتاست"}),e.jsx(p,{value:a.name,onChange:s=>r({...a,name:s.target.value}),placeholder:"مثال: persian-news-corpus"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع دیتاست"}),e.jsxs(F,{value:a.type,onChange:s=>r({...a,type:s.target.value}),children:[e.jsx("option",{value:"text",children:"متنی"}),e.jsx("option",{value:"audio",children:"صوتی"}),e.jsx("option",{value:"structured",children:"ساختار یافته"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"توضیحات (اختیاری)"}),e.jsx(p,{value:a.description,onChange:s=>r({...a,description:s.target.value}),placeholder:"توضیحات دیتاست..."})]}),f&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"در حال آپلود..."}),e.jsxs("span",{children:[j,"%"]})]}),e.jsx(M,{value:j})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{variant:"primary",onClick:I,loading:f,disabled:!a.name,children:"آپلود و پردازش"}),e.jsx(c,{variant:"ghost",onClick:()=>{t.current.value="",r({name:"",type:"text",description:""})},children:"انصراف"})]})]})]}):null,e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[color:var(--c-text-secondary)]"}),e.jsx(p,{className:"pr-10",placeholder:"جستجو در دیتاست‌ها...",value:m,onChange:s=>C(s.target.value)})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.length===0?e.jsxs(u,{className:"col-span-full p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 mx-auto mb-4 text-[color:var(--c-text-secondary)]"}),e.jsx("p",{className:"text-lg text-[color:var(--c-text-secondary)]",children:"هیچ دیتاستی یافت نشد"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-secondary)] mt-2",children:'با کلیک روی دکمه "آپلود دیتاست جدید" شروع کنید'})]}):g.map(s=>e.jsxs(u,{className:"p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.status==="ready"?"bg-green-100 text-green-800":s.status==="processing"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:s.status==="ready"?"آماده":s.status==="processing"?"در حال پردازش":"خطا"})]}),s.description&&e.jsx("p",{className:"text-sm text-[color:var(--c-text-secondary)] mb-3",children:s.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[color:var(--c-text-secondary)]",children:"نوع:"}),e.jsx("span",{children:s.type==="text"?"متنی":s.type==="audio"?"صوتی":"ساختار یافته"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[color:var(--c-text-secondary)]",children:"تعداد ردیف:"}),e.jsx("span",{children:s.stats.rows.toLocaleString("fa-IR")})]}),s.stats.tokens&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[color:var(--c-text-secondary)]",children:"تعداد توکن:"}),e.jsx("span",{children:s.stats.tokens.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[color:var(--c-text-secondary)]",children:"حجم:"}),e.jsx("span",{children:y(s.stats.size)})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(c,{variant:"secondary",size:"sm",icon:e.jsx(R,{className:"w-4 h-4"}),className:"flex-1",children:"آمار"}),e.jsx(c,{variant:"ghost",size:"sm",icon:e.jsx(U,{className:"w-4 h-4"}),className:"flex-1",children:"دانلود"}),e.jsx(c,{variant:"ghost",size:"sm",icon:e.jsx(B,{className:"w-4 h-4"}),className:"text-red-600",children:"حذف"})]})]},s.id))}),e.jsx("input",{ref:t,type:"file",accept:".csv,.json,.txt,.jsonl",onChange:S,className:"hidden"})]})}export{G as DatasetManagerPage};
