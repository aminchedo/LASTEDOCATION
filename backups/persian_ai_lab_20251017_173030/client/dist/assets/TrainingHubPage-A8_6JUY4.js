import{c as P,j as e,b as y,d as w,f as z,P as _,a2 as oe,C as L,Y as de,S as xe,B as p,s as je,G as O,z as v,g as K,R as Q,T as B,A as J,H as X,e as q,l as ve,t as E,a as ge,v as pe,J as fe,a3 as Ne,Z as be,I as W}from"./index-Br5p3c61.js";import{b as d}from"./react-vendor-CHIk2tMd.js";import{Q as ye,T as we,a as ke,b as re,c as ce}from"./QuickActions-DJLzR9I4.js";import{f as Se}from"./index-Bm_8qgMr.js";import{B as A}from"./badge-DlDO3Hl1.js";import{P as me}from"./Progress-48by0XhX.js";import{u as Y,T as he}from"./useTraining-Dp2d4kx-.js";import{C as V}from"./circle-check-big-BW1H2Pf2.js";import{C as U}from"./clock-BXxtL5XS.js";import{C as Ce}from"./calendar-BTWnThVv.js";import{a as H}from"./api.service-CxHt9VSM.js";import{M as Te}from"./mic-Dvnds8DU.js";import{M as le}from"./MiniBar-BBmllMqT.js";import{m as Re}from"./proxy-qrGj2Bpm.js";import"./api-BM4dxxsF.js";import"./auth.service-DTA6mi50.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=P("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=P("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=P("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=P("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=P("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=P("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function Le(){const{jobs:i,loading:x}=Y();if(x)return e.jsx(y,{variant:"elevated",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(m=>e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"},m))})]})})});const u=i.find(m=>m.status==="running"||m.status==="completed");if(!u)return e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsx("h2",{className:"text-xl font-semibold text-[color:var(--c-text)]",children:"وضعیت آموزش"})}),e.jsx(w,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-16 h-16 mx-auto mb-4 text-[color:var(--c-text-muted)]"}),e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)] mb-2",children:"هیچ آموزش فعالی وجود ندارد"}),e.jsx("p",{className:"text-[color:var(--c-text-muted)]",children:"برای شروع آموزش، از بخش کنترل‌ها استفاده کنید"})]})})]});const r=u,n=u.metrics,g=null,f=()=>{switch(r.status){case"running":return e.jsx(_,{className:"w-5 h-5 text-green-600"});case"paused":return e.jsx(de,{className:"w-5 h-5 text-yellow-600"});case"completed":return e.jsx(V,{className:"w-5 h-5 text-green-600"});case"error":return e.jsx(L,{className:"w-5 h-5 text-red-600"});default:return e.jsx(oe,{className:"w-5 h-5 text-gray-600"})}},T=()=>{switch(r.status){case"running":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300";case"paused":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300";case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300";case"error":return"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300";default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}},j=(m,$)=>{const h=new Date(m).getTime(),k=$?new Date($).getTime():Date.now(),t=Math.floor((k-h)/1e3);if(t<60)return`${t}ثانیه`;const s=Math.floor(t/60),c=t%60;return`${s}دقیقه ${c}ثانیه`},R=m=>{if(!m)return"—";if(m<60)return`${m}ثانیه`;const $=Math.floor(m/60),h=m%60;return`${$}دقیقه ${h}ثانیه`};return e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-[color:var(--c-text)]",children:"وضعیت آموزش"}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${T()}`,children:[f(),e.jsx("span",{children:r.status==="running"?"در حال اجرا":r.status==="paused"?"متوقف شده":r.status==="completed"?"تکمیل شده":r.status==="error"?"خطا":"آماده"})]})]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-[color:var(--c-text)]",children:"پیشرفت کلی:"}),e.jsxs("span",{className:"text-[color:var(--c-text)] font-medium",children:[r.progress,"%"]})]}),e.jsx(me,{value:r.progress,className:"h-3"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-[color:var(--c-text-muted)]",children:[e.jsxs("span",{children:["مرحله ",r.currentStep," از ",r.totalSteps]}),e.jsxs("span",{children:["دوره ",r.currentEpoch," از ",r.totalEpochs]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-xs text-[color:var(--c-text-muted)]",children:"Loss فعلی"})]}),e.jsx("div",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:n?.loss?n.loss.toFixed(4):"—"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($e,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-xs text-[color:var(--c-text-muted)]",children:"بهترین Loss"})]}),e.jsx("div",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:r.bestMetric?r.bestMetric.toFixed(4):"—"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-[color:var(--c-text-muted)]",children:"دقت"})]}),e.jsx("div",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:n?.accuracy?`${(n.accuracy*100).toFixed(1)}%`:"—"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-[color:var(--c-text-muted)]",children:"زمان باقی‌مانده"})]}),e.jsx("div",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:R(r.eta)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-[color:var(--c-border)]",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"شروع:"}),e.jsx("span",{className:"mr-2 text-[color:var(--c-text)]",children:new Date(r.startedAt).toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"مدت زمان:"}),e.jsx("span",{className:"mr-2 text-[color:var(--c-text)]",children:j(r.startedAt,r.finishedAt)})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"شناسه:"}),e.jsx("span",{className:"mr-2 text-[color:var(--c-text)] font-mono text-xs",children:r.id.slice(-8)})]})]}),g]})]})}function De(){const{jobs:i,loading:x,startTraining:u,stopTraining:r}=Y(),[n,g]=d.useState({totalEpochs:10,totalSteps:1e3,learningRate:.001,batchSize:32,saveEverySteps:100}),[f,T]=d.useState(""),j=async()=>{try{await u({...n,resumeCheckpointId:f||void 0}),v.success("آموزش با موفقیت شروع شد")}catch(c){v.error(`خطا: ${c.message}`)}},R=async()=>{try{const c=i.find(N=>N.status==="running");c&&(await r(c.id),v.success("آموزش متوقف شد"))}catch(c){v.error(`خطا: ${c.message}`)}},m=async()=>{try{const c=i.find(N=>N.status==="running");c&&(await r(c.id),v.success("آموزش متوقف شد"))}catch(c){v.error(`خطا: ${c.message}`)}},$=async()=>{try{v.success("عملیات ذخیره چک‌پوینت در حال پیاده‌سازی است")}catch(c){v.error(`خطا: ${c.message}`)}},h=i.find(c=>c.status==="running"),k=!!h,t=!1,s=!k;return e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsxs("h2",{className:"text-xl font-semibold text-[color:var(--c-text)] flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"کنترل‌های آموزش"]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[s&&e.jsx(p,{variant:"primary",size:"lg",icon:e.jsx(_,{className:"w-5 h-5"}),onClick:j,disabled:x,children:"شروع آموزش"}),k&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"secondary",size:"lg",icon:e.jsx(de,{className:"w-5 h-5"}),onClick:R,disabled:x,children:"توقف"}),e.jsx(p,{variant:"destructive",size:"lg",icon:e.jsx(oe,{className:"w-5 h-5"}),onClick:m,disabled:x,children:"متوقف کردن"})]}),t,(k||t)&&e.jsx(p,{variant:"outline",size:"lg",icon:e.jsx(je,{className:"w-5 h-5"}),onClick:$,disabled:x,children:"ذخیره چک‌پوینت"})]}),s&&e.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsx("h3",{className:"text-lg font-medium text-[color:var(--c-text)]",children:"پیکربندی آموزش"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"تعداد دوره‌ها"}),e.jsx(O,{type:"number",value:n.totalEpochs,onChange:c=>g(N=>({...N,totalEpochs:parseInt(c.target.value)})),min:1,max:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"تعداد مراحل"}),e.jsx(O,{type:"number",value:n.totalSteps,onChange:c=>g(N=>({...N,totalSteps:parseInt(c.target.value)})),min:100,max:1e4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"نرخ یادگیری"}),e.jsx(O,{type:"number",step:"0.0001",value:n.learningRate,onChange:c=>g(N=>({...N,learningRate:parseFloat(c.target.value)})),min:1e-4,max:.01})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"اندازه دسته"}),e.jsx(O,{type:"number",value:n.batchSize,onChange:c=>g(N=>({...N,batchSize:parseInt(c.target.value)})),min:1,max:128})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"ذخیره هر N مرحله"}),e.jsx(O,{type:"number",value:n.saveEverySteps,onChange:c=>g(N=>({...N,saveEverySteps:parseInt(c.target.value)})),min:10,max:1e3})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[color:var(--c-text)] mb-2",children:"ادامه از چک‌پوینت (اختیاری)"}),e.jsxs("select",{className:"w-full px-4 py-2 rounded-lg border border-[color:var(--c-border)] bg-[color:var(--c-bg)] text-[color:var(--c-text)] focus:outline-none focus:ring-2 focus:ring-[color:var(--c-primary)]",value:f,onChange:c=>T(c.target.value),children:[e.jsx("option",{value:"",children:"شروع جدید"}),e.jsx("option",{value:"checkpoint_1",children:"آخرین چک‌پوینت"}),e.jsx("option",{value:"checkpoint_2",children:"بهترین چک‌پوینت"})]})]})]}),h&&e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsx("h3",{className:"text-lg font-medium text-[color:var(--c-text)] mb-3",children:"اطلاعات جلسه فعلی"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"شناسه:"}),e.jsx("span",{className:"mr-2 text-[color:var(--c-text)] font-mono",children:h.id.slice(-12)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"وضعیت:"}),e.jsx(A,{variant:k?"success":"default",className:"mr-2",children:k?"در حال اجرا":"آماده"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"شروع:"}),e.jsx("span",{className:"mr-2 text-[color:var(--c-text)]",children:h.startedAt?new Date(h.startedAt).toLocaleString("fa-IR"):"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"پیشرفت:"}),e.jsxs("span",{className:"mr-2 text-[color:var(--c-text)]",children:[h.progress,"%"]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsx("h3",{className:"text-lg font-medium text-[color:var(--c-text)] mb-3",children:"میانبرهای صفحه‌کلید"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-[color:var(--c-text-muted)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-[color:var(--c-bg)] border border-[color:var(--c-border)] rounded text-xs",children:"Space"}),e.jsx("span",{children:"توقف/ادامه آموزش"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-[color:var(--c-bg)] border border-[color:var(--c-border)] rounded text-xs",children:"Esc"}),e.jsx("span",{children:"متوقف کردن آموزش"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-[color:var(--c-bg)] border border-[color:var(--c-border)] rounded text-xs",children:"S"}),e.jsx("span",{children:"ذخیره چک‌پوینت"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-[color:var(--c-bg)] border border-[color:var(--c-border)] rounded text-xs",children:"R"}),e.jsx("span",{children:"شروع مجدد"})]})]})]}),i.some(c=>c.status==="failed")&&e.jsxs("div",{className:"p-4 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 mb-2",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"خطا در آموزش"})]}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"آموزش با خطا مواجه شد. لطفاً لاگ‌ها را بررسی کنید و مجدداً تلاش کنید."})]})]})]})}function Fe(){const{jobs:i}=Y(),[x,u]=d.useState("loss"),[r,n]=d.useState([]),[g,f]=d.useState(!1),[T,j]=d.useState(1),R=[{id:"loss",label:"Loss",icon:he},{id:"accuracy",label:"دقت",icon:B},{id:"throughput",label:"عملکرد",icon:J}],m=async()=>{if(i.find(o=>o.status==="running")){f(!0);try{const S=await(await fetch("/api/train/metrics")).json();S.success&&n(S.data)}catch(o){console.error("Failed to fetch metrics:",o)}finally{f(!1)}}};d.useEffect(()=>{m();const a=setInterval(()=>{i.find(S=>S.status==="running")&&m()},2e3);return()=>clearInterval(a)},[i]);const h=(()=>{if(!r.length)return[];switch(x){case"loss":return r.map(a=>({x:a.step,y:a.loss,valY:a.valLoss,epoch:a.epoch}));case"accuracy":return r.map(a=>({x:a.step,y:a.accuracy?a.accuracy*100:0,valY:a.valAccuracy?a.valAccuracy*100:0,epoch:a.epoch}));case"throughput":return r.map(a=>({x:a.step,y:a.throughput||0,valY:0,epoch:a.epoch}));default:return[]}})(),k=r[r.length-1],t=()=>{switch(x){case"loss":return"Loss";case"accuracy":return"دقت (%)";case"throughput":return"نمونه/ثانیه";default:return""}},s=()=>{if(!k)return"—";switch(x){case"loss":return k.loss.toFixed(4);case"accuracy":return k.accuracy?`${(k.accuracy*100).toFixed(1)}%`:"—";case"throughput":return k.throughput?k.throughput.toFixed(1):"—";default:return"—"}},c=()=>{if(!h.length)return{min:0,max:1};const a=h.map(o=>o.y).filter(o=>o!==void 0);return a.length===0?{min:0,max:1}:{min:Math.min(...a),max:Math.max(...a)}},{min:N,max:I}=c(),l=(I-N)*.1,b=()=>{if(!h.length)return e.jsx("div",{className:"flex items-center justify-center h-64 text-[color:var(--c-text-muted)]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"هیچ داده‌ای برای نمایش وجود ندارد"})]})});const a=800,o=300,S={top:20,right:20,bottom:40,left:60},Z=a-S.left-S.right,D=o-S.top-S.bottom,ee=C=>{const M=Math.max(...h.map(F=>F.x));return C/M*Z},se=C=>{const M=N-l,F=I+l;return D-(C-M)/(F-M)*D},te=h.map(C=>`${ee(C.x)},${se(C.y)}`).join(" "),ae=h.filter(C=>C.valY!==void 0).map(C=>`${ee(C.x)},${se(C.valY)}`).join(" ");return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:a,height:o,className:"w-full",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"lossGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--c-primary)",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"var(--c-primary)",stopOpacity:"0"})]})}),e.jsxs("g",{transform:`translate(${S.left},${S.top})`,children:[[0,.25,.5,.75,1].map(C=>{const M=D*C,F=N-l+(I+l-(N-l))*(1-C);return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:M,x2:Z,y2:M,stroke:"var(--c-border)",strokeWidth:"1",opacity:"0.3"}),e.jsx("text",{x:-10,y:M+4,textAnchor:"end",fontSize:"12",fill:"var(--c-text-muted)",children:F.toFixed(2)})]},C)}),[0,.25,.5,.75,1].map(C=>{const M=Z*C,F=Math.max(...h.map(ue=>ue.x))*C;return e.jsxs("g",{children:[e.jsx("line",{x1:M,y1:0,x2:M,y2:D,stroke:"var(--c-border)",strokeWidth:"1",opacity:"0.3"}),e.jsx("text",{x:M,y:D+20,textAnchor:"middle",fontSize:"12",fill:"var(--c-text-muted)",children:Math.round(F)})]},C)}),e.jsx("polyline",{points:te,fill:"none",stroke:"var(--c-primary)",strokeWidth:"2"}),ae&&e.jsx("polyline",{points:ae,fill:"none",stroke:"var(--c-secondary)",strokeWidth:"2",strokeDasharray:"5,5"}),e.jsx("polygon",{points:`0,${D} ${te} ${Z},${D}`,fill:"url(#lossGradient)"})]}),e.jsx("text",{x:a/2,y:o-5,textAnchor:"middle",fontSize:"14",fill:"var(--c-text-muted)",children:"مرحله"}),e.jsx("text",{x:15,y:o/2,textAnchor:"middle",fontSize:"14",fill:"var(--c-text-muted)",transform:`rotate(-90, 15, ${o/2})`,children:t()})]})})};return e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[color:var(--c-text)] flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"نمودار معیارها"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(ze,{className:"w-4 h-4"}),onClick:()=>j(Math.max(.5,T-.1))}),e.jsxs("span",{className:"text-sm text-[color:var(--c-text-muted)]",children:[Math.round(T*100),"%"]}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(Me,{className:"w-4 h-4"}),onClick:()=>j(Math.min(2,T+.1))}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(Q,{className:"w-4 h-4"}),onClick:m,disabled:g})]})]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-2 border-b border-[color:var(--c-border)]",children:R.map(a=>{const o=a.icon;return e.jsxs(p,{variant:x===a.id?"primary":"ghost",onClick:()=>u(a.id),className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),a.label]},a.id)})}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[color:var(--c-text-muted)]",children:"آخرین مقدار:"}),e.jsx("span",{className:"mr-2 text-lg font-semibold text-[color:var(--c-text)]",children:s()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[color:var(--c-text-muted)]",children:[e.jsxs("div",{children:[e.jsx("span",{children:"حداقل:"}),e.jsx("span",{className:"mr-1 text-[color:var(--c-text)]",children:N.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"حداکثر:"}),e.jsx("span",{className:"mr-1 text-[color:var(--c-text)]",children:I.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"تعداد نقاط:"}),e.jsx("span",{className:"mr-1 text-[color:var(--c-text)]",children:h.length})]})]})]}),e.jsxs("div",{className:"relative",children:[g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-10",children:e.jsxs("div",{className:"flex items-center gap-2 text-[color:var(--c-text-muted)]",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-[color:var(--c-primary)] border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"در حال بارگذاری..."})]})}),b()]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-[color:var(--c-primary)]"}),e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"آموزش"})]}),h.some(a=>a.valY!==void 0)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-[color:var(--c-secondary)] border-dashed border-t-2 border-[color:var(--c-secondary)]"}),e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"اعتبارسنجی"})]})]}),r.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 rounded-lg bg-[color:var(--c-bg-secondary)]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[color:var(--c-text-muted)]",children:"میانگین Loss"}),e.jsx("div",{className:"text-sm font-medium text-[color:var(--c-text)]",children:(r.reduce((a,o)=>a+o.loss,0)/r.length).toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[color:var(--c-text-muted)]",children:"میانگین دقت"}),e.jsx("div",{className:"text-sm font-medium text-[color:var(--c-text)]",children:r.filter(a=>a.accuracy).length>0?`${(r.filter(a=>a.accuracy).reduce((a,o)=>a+(o.accuracy||0),0)/r.filter(a=>a.accuracy).length*100).toFixed(1)}%`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[color:var(--c-text-muted)]",children:"میانگین عملکرد"}),e.jsx("div",{className:"text-sm font-medium text-[color:var(--c-text)]",children:r.filter(a=>a.throughput).length>0?`${(r.filter(a=>a.throughput).reduce((a,o)=>a+(o.throughput||0),0)/r.filter(a=>a.throughput).length).toFixed(1)}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[color:var(--c-text-muted)]",children:"زمان میانگین مرحله"}),e.jsx("div",{className:"text-sm font-medium text-[color:var(--c-text)]",children:r.filter(a=>a.stepTimeMs).length>0?`${(r.filter(a=>a.stepTimeMs).reduce((a,o)=>a+(o.stepTimeMs||0),0)/r.filter(a=>a.stepTimeMs).length).toFixed(0)}ms`:"—"})]})]})]})]})}function Ee(){const{jobs:i}=Y(),[x,u]=d.useState([]),[r,n]=d.useState(!1),[g,f]=d.useState(""),T=async()=>{n(!0);try{const s=await(await fetch("/api/train/checkpoints")).json();s.success&&u(s.data)}catch(t){console.error("Failed to fetch checkpoints:",t),v.error("خطا در بارگذاری چک‌پوینت‌ها")}finally{n(!1)}};d.useEffect(()=>{T()},[]);const j=async t=>{try{v.success(`دانلود چک‌پوینت ${t.id.slice(-8)} شروع شد`)}catch(s){v.error(`خطا در دانلود: ${s.message}`)}},R=async t=>{if(confirm(`آیا مطمئن هستید که می‌خواهید چک‌پوینت ${t.id.slice(-8)} را حذف کنید؟`))try{if((await fetch(`/api/train/checkpoints/${t.id}`,{method:"DELETE"})).ok)v.success("چک‌پوینت حذف شد"),T();else throw new Error("Failed to delete checkpoint")}catch(s){v.error(`خطا در حذف: ${s.message}`)}},m=async t=>{try{if((await fetch("/api/train/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resumeCheckpointId:t.id,totalEpochs:10,totalSteps:1e3,learningRate:.001,batchSize:32,saveEverySteps:100})})).ok)v.success(`آموزش از چک‌پوینت ${t.id.slice(-8)} شروع شد`);else throw new Error("Failed to resume training")}catch(s){v.error(`خطا در ادامه آموزش: ${s.message}`)}},$=t=>{switch(t){case"best":return e.jsx(ie,{className:"w-4 h-4 text-yellow-500"});case"latest":return e.jsx(U,{className:"w-4 h-4 text-blue-500"});case"manual":return e.jsx(L,{className:"w-4 h-4 text-green-500"});default:return null}},h=t=>{switch(t){case"best":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300";case"latest":return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300";case"manual":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300";default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}},k=t=>new Date(t).toLocaleString("fa-IR");return r?e.jsx(y,{variant:"elevated",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"},t))})]})})}):e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[color:var(--c-text)] flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"چک‌پوینت‌ها"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(p,{variant:"outline",size:"sm",icon:e.jsx(Q,{className:"w-4 h-4"}),onClick:T,disabled:r,children:"بروزرسانی"})})]})}),e.jsx(w,{children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 text-[color:var(--c-text-muted)]"}),e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)] mb-2",children:"هیچ چک‌پوینتی وجود ندارد"}),e.jsx("p",{className:"text-[color:var(--c-text-muted)]",children:"چک‌پوینت‌ها پس از شروع آموزش ایجاد می‌شوند"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-2 text-sm font-medium text-[color:var(--c-text-muted)] border-b border-[color:var(--c-border)]",children:[e.jsx("div",{className:"col-span-3",children:"شناسه"}),e.jsx("div",{className:"col-span-2",children:"نوع"}),e.jsx("div",{className:"col-span-2",children:"معیار"}),e.jsx("div",{className:"col-span-2",children:"تاریخ"}),e.jsx("div",{className:"col-span-3",children:"عملیات"})]}),x.map(t=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 rounded-lg hover:bg-[color:var(--c-bg-secondary)] transition-colors",children:[e.jsx("div",{className:"col-span-3 flex items-center gap-2",children:e.jsx("code",{className:"text-sm font-mono text-[color:var(--c-text)] bg-[color:var(--c-bg-secondary)] px-2 py-1 rounded",children:t.id.slice(-12)})}),e.jsx("div",{className:"col-span-2",children:e.jsx(A,{variant:"outline",className:`text-xs ${h(t.tag)}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[$(t.tag),e.jsx("span",{children:t.tag==="best"?"بهترین":t.tag==="latest"?"آخرین":t.tag==="manual"?"دستی":t.tag})]})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-sm text-[color:var(--c-text)]",children:t.metric?t.metric.toFixed(4):"—"})}),e.jsxs("div",{className:"col-span-2 flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-[color:var(--c-text-muted)]"}),e.jsx("span",{className:"text-sm text-[color:var(--c-text)]",children:k(t.createdAt)})]}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(Q,{className:"w-4 h-4"}),onClick:()=>m(t),disabled:i.some(s=>s.status==="running"),title:"ادامه از این چک‌پوینت"}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(q,{className:"w-4 h-4"}),onClick:()=>j(t),title:"دانلود چک‌پوینت"}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(ve,{className:"w-4 h-4"}),onClick:()=>R(t),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/30",title:"حذف چک‌پوینت"})]})]},t.id)),e.jsx("div",{className:"pt-4 border-t border-[color:var(--c-border)]",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-[color:var(--c-text-muted)]",children:[e.jsxs("span",{children:["تعداد کل چک‌پوینت‌ها: ",x.length]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{children:["بهترین: ",x.filter(t=>t.tag==="best").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{children:["آخرین: ",x.filter(t=>t.tag==="latest").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:["دستی: ",x.filter(t=>t.tag==="manual").length]})]})]})]})})]})})]})}function Ae(){const[i,x]=d.useState(null),[u,r]=d.useState(!1),n=async()=>{r(!0);try{const g=await H.getTrainingStatus();g.success?x({isHealthy:!0,apiSource:"local",modelId:"main_model",lastChecked:new Date().toISOString()}):x({isHealthy:!1,apiSource:"unknown",modelId:"unknown",lastChecked:new Date().toISOString(),error:g.error||"Unknown error"})}catch(g){x({isHealthy:!1,apiSource:"unknown",modelId:"unknown",lastChecked:new Date().toISOString(),error:g.message||"Failed to connect to training API"})}finally{r(!1)}};return d.useEffect(()=>{n();const g=setInterval(n,3e4);return()=>clearInterval(g)},[]),i?i.isHealthy?e.jsx(y,{variant:"outline",className:"border-green-200 dark:border-green-800",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"سیستم آموزش آماده است"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["API: ",i.apiSource," • مدل: ",i.modelId]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"success",className:"text-xs",children:"آنلاین"}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(E,{className:`w-4 h-4 ${u?"animate-spin":""}`}),onClick:n,disabled:u})]})]})})}):e.jsx(y,{variant:"outline",className:"border-red-200 dark:border-red-800",children:e.jsxs(w,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:"مشکل در اتصال به سیستم آموزش"}),e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:i.error})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"error",className:"text-xs",children:"آفلاین"}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(E,{className:`w-4 h-4 ${u?"animate-spin":""}`}),onClick:n,disabled:u}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(xe,{className:"w-4 h-4"}),onClick:()=>{console.log("Open settings")}})]})]}),e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-red-50 dark:bg-red-900/20",children:[e.jsx("h4",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-2",children:"راه‌حل‌های پیشنهادی:"}),e.jsxs("ul",{className:"text-xs text-red-600 dark:text-red-400 space-y-1",children:[e.jsx("li",{children:"• اطمینان حاصل کنید که سرور backend در حال اجرا است"}),e.jsx("li",{children:"• بررسی کنید که پورت 3001 در دسترس باشد"}),e.jsx("li",{children:"• در صورت نیاز، تنظیمات API را بررسی کنید"}),e.jsx("li",{children:"• سرور را مجدداً راه‌اندازی کنید"})]})]})]})}):e.jsx(y,{variant:"outline",className:"border-gray-200 dark:border-gray-700",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-[color:var(--c-text-muted)]",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm",children:"در حال بررسی وضعیت سیستم..."})]})})})}function qe(){const[i,x]=d.useState([]),[u,r]=d.useState(!1),n=async()=>{r(!0);try{const c=await(await fetch("/api/bootstrap/download/status")).json();c.success&&x(c.data)}catch(s){console.error("Failed to fetch downloads:",s),v.error("خطا در بارگذاری وضعیت دانلودها")}finally{r(!1)}};d.useEffect(()=>{n();const s=setInterval(n,5e3);return()=>clearInterval(s)},[]);const g=async s=>{try{if((await fetch("/api/bootstrap/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kind:s.kind,id:s.id,dest:`datasets/${s.kind}/${s.id}`})})).ok)v.success(`دانلود ${s.name} شروع شد`),n();else throw new Error("Failed to start download")}catch(c){v.error(`خطا در شروع دانلود: ${c.message}`)}},f=async s=>{if(confirm(`آیا مطمئن هستید که می‌خواهید ${s.name} را مجدداً نصب کنید؟`))try{if((await fetch("/api/bootstrap/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kind:s.kind,id:s.id,dest:`datasets/${s.kind}/${s.id}`})})).ok)v.success(`نصب مجدد ${s.name} شروع شد`),n();else throw new Error("Failed to start reinstall")}catch(c){v.error(`خطا در نصب مجدد: ${c.message}`)}},T=async s=>{try{v.success(`تأیید ${s.name} تکمیل شد`)}catch(c){v.error(`خطا در تأیید: ${c.message}`)}},j=s=>{switch(s){case"text":return e.jsx(pe,{className:"w-5 h-5 text-blue-500"});case"asr":return e.jsx(Te,{className:"w-5 h-5 text-green-500"});case"tts":return e.jsx(Ie,{className:"w-5 h-5 text-purple-500"});case"model":return e.jsx(ge,{className:"w-5 h-5 text-orange-500"});default:return e.jsx(X,{className:"w-5 h-5 text-gray-500"})}},R=s=>{switch(s){case"text":return"متن";case"asr":return"تشخیص گفتار";case"tts":return"تبدیل متن به گفتار";case"model":return"مدل";default:return s}},m=s=>{switch(s){case"installed":return e.jsx(V,{className:"w-5 h-5 text-green-500"});case"downloading":return e.jsx(E,{className:"w-5 h-5 text-blue-500 animate-spin"});case"error":return e.jsx(L,{className:"w-5 h-5 text-red-500"});default:return e.jsx(q,{className:"w-5 h-5 text-gray-500"})}},$=s=>{switch(s){case"installed":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300";case"downloading":return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300";case"error":return"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300";default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}},h=s=>{switch(s){case"installed":return"نصب شده";case"downloading":return"در حال دانلود";case"error":return"خطا";default:return"نصب نشده"}},k=s=>{if(s===0)return"0 B";const c=1024,N=["B","KB","MB","GB"],I=Math.floor(Math.log(s)/Math.log(c));return parseFloat((s/Math.pow(c,I)).toFixed(2))+" "+N[I]},t=s=>new Date(s).toLocaleString("fa-IR");return u?e.jsx(y,{variant:"elevated",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},s))})]})})}):e.jsxs(y,{variant:"elevated",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[color:var(--c-text)] flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"مرکز دانلود"]}),e.jsx(p,{variant:"outline",size:"sm",icon:e.jsx(E,{className:"w-4 h-4"}),onClick:n,disabled:u,children:"بروزرسانی"})]})}),e.jsx(w,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-4 text-[color:var(--c-text-muted)]"}),e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)] mb-2",children:"هیچ آیتمی برای دانلود وجود ندارد"}),e.jsx("p",{className:"text-[color:var(--c-text-muted)]",children:"لطفاً بعداً مجدداً بررسی کنید"})]}):e.jsxs("div",{className:"space-y-4",children:[i.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-[color:var(--c-border)] hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[j(s.kind),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-[color:var(--c-text)]",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(A,{variant:"outline",className:"text-xs",children:R(s.kind)}),e.jsx("span",{className:"text-sm text-[color:var(--c-text-muted)]",children:k(s.size)})]})]})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${$(s.status)}`,children:[m(s.status),e.jsx("span",{children:h(s.status)})]})]}),s.status==="downloading"&&s.progress!==void 0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"پیشرفت دانلود:"}),e.jsxs("span",{className:"text-[color:var(--c-text)] font-medium",children:[s.progress,"%"]})]}),e.jsx(me,{value:s.progress,className:"h-2"})]}),s.checksum&&e.jsx("div",{className:"mb-3 p-2 rounded bg-[color:var(--c-bg-secondary)]",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-[color:var(--c-text-muted)]"}),e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"چکسام:"}),e.jsx("code",{className:"text-xs font-mono text-[color:var(--c-text)]",children:s.checksum})]})}),s.installedAt&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm text-[color:var(--c-text-muted)]",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:["نصب شده در: ",t(s.installedAt)]})]}),s.error&&e.jsx("div",{className:"mb-3 p-2 rounded bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-700 dark:text-red-300",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:s.error})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="not_installed"&&e.jsx(p,{variant:"primary",size:"sm",icon:e.jsx(q,{className:"w-4 h-4"}),onClick:()=>g(s),children:"نصب"}),s.status==="installed"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outline",size:"sm",icon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>f(s),children:"نصب مجدد"}),e.jsx(p,{variant:"outline",size:"sm",icon:e.jsx(ne,{className:"w-4 h-4"}),onClick:()=>T(s),children:"تأیید"})]}),s.status==="error"&&e.jsx(p,{variant:"primary",size:"sm",icon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>g(s),children:"تلاش مجدد"})]})]},s.id)),e.jsx("div",{className:"pt-4 border-t border-[color:var(--c-border)]",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:i.length}),e.jsx("div",{className:"text-[color:var(--c-text-muted)]",children:"کل آیتم‌ها"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:i.filter(s=>s.status==="installed").length}),e.jsx("div",{className:"text-[color:var(--c-text-muted)]",children:"نصب شده"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:i.filter(s=>s.status==="downloading").length}),e.jsx("div",{className:"text-[color:var(--c-text-muted)]",children:"در حال دانلود"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-red-600",children:i.filter(s=>s.status==="error").length}),e.jsx("div",{className:"text-[color:var(--c-text-muted)]",children:"خطا"})]})]})})]})})]})}function Pe(){const[i,x]=d.useState("overview"),{jobs:u,loading:r,error:n}=Y(),f=u.find(j=>j.status==="running"||j.status==="paused"||j.status==="error"),T=[{id:"overview",label:"نمای کلی",icon:J},{id:"metrics",label:"معیارها",icon:J},{id:"checkpoints",label:"چک‌پوینت‌ها",icon:J},{id:"downloads",label:"دانلودها",icon:J}];return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-[color:var(--c-text)] flex items-center gap-3",children:[e.jsx(fe,{className:"w-8 h-8 text-[color:var(--c-primary)]"}),"استودیوی آموزش"]}),e.jsx("p",{className:"text-[color:var(--c-text-muted)] mt-1",children:"آموزش و مدیریت مدل‌های زبانی فارسی"})]}),e.jsx(A,{variant:f?.status==="running"?"success":f?.status==="paused"?"warning":f?.status==="error"?"error":"default",className:"text-sm px-3 py-1",children:f?.status==="running"?"در حال اجرا":f?.status==="paused"?"متوقف شده":f?.status==="error"?"خطا":"آماده"})]}),e.jsx(Ae,{}),e.jsx("div",{className:"flex gap-2 border-b border-[color:var(--c-border)]",children:T.map(j=>{const R=j.icon;return e.jsxs(p,{variant:i===j.id?"primary":"ghost",onClick:()=>x(j.id),className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),j.label]},j.id)})}),i==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Le,{}),e.jsx(De,{})]}),i==="metrics"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Fe,{})}),i==="checkpoints"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Ee,{})}),i==="downloads"&&e.jsx("div",{className:"space-y-6",children:e.jsx(qe,{})}),n&&e.jsx(y,{variant:"outline",className:"border-red-200 dark:border-red-800",children:e.jsxs(w,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-600 dark:text-red-400",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"خطا در بارگذاری"})]}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-2",children:n})]})}),r&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3 text-[color:var(--c-text-muted)]",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-[color:var(--c-primary)] border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"در حال بارگذاری..."})]})})]})}function Oe(){const[i,x]=d.useState("24h"),[u,r]=d.useState(!1),[n,g]=d.useState({requests:[],responseTime:[],errorRate:[],activeUsers:[]}),[f,T]=d.useState([]),[j,R]=d.useState([]),[m,$]=d.useState({totalRequests:0,avgResponseTimeMs:0,successRate:0,errorRate:0}),[h,k]=d.useState(null),t=d.useCallback((l,b=0)=>typeof l=="number"?l:typeof l=="string"&&parseFloat(l)||b,[]),s=d.useCallback(async()=>{r(!0),k(null);try{const[l,b,a,o]=await Promise.all([H.getMetrics(),H.getTimeSeriesData(),H.getModelBreakdown(),H.getPercentiles()]);if(l.success&&l.data)$({totalRequests:t(l.data.totalRequests),avgResponseTimeMs:t(l.data.avgResponseTimeMs),successRate:t(l.data.successRate),errorRate:t(l.data.errorRate)});else if(!l.success)throw new Error(l.message||"Failed to fetch metrics");b.success&&b.data&&g({requests:b.data.requests||[],responseTime:b.data.responseTime||[],errorRate:b.data.errorRate||[],activeUsers:b.data.activeUsers||[]}),a.success&&a.data&&T((b.data||[]).map(S=>({model:S.model||"Unknown",requests:t(S.requests),avgResponseTime:t(S.avgResponseTime),successRate:t(S.successRate),color:S.color||"bg-gray-500"}))),o.success&&o.data&&R((o.data||[]).map(S=>({percentile:S.percentile||"P50",value:t(S.value),color:S.color||"text-gray-600"}))),v.success("داده‌ها به‌روزرسانی شد")}catch(l){const b=l instanceof Error?l.message:"خطا در دریافت داده‌ها";k(b),console.error("Failed to fetch metrics:",l),v.error(b)}finally{r(!1)}},[t]),c=d.useCallback(()=>{s()},[s]);d.useEffect(()=>{s()},[s,i]);const N=d.useCallback(()=>{const l={timeSeries:n,modelBreakdown:f,percentiles:j,stats:m,timeRange:i,exportedAt:new Date().toISOString()},b=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),a=URL.createObjectURL(b),o=document.createElement("a");o.href=a,o.download=`metrics-dashboard-${Date.now()}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),v.success("داده‌ها صادر شد")},[n,f,j,m,i]),I=d.useCallback(l=>new Date(l).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"}),[]),G=f.reduce((l,b)=>l+t(b.requests),0);return h?e.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-6 space-y-6",children:e.jsx(y,{variant:"elevated",children:e.jsxs(w,{className:"p-6 text-center",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"خطا در بارگیری داده‌ها"}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsx(p,{onClick:c,variant:"primary",children:"تلاش مجدد"})]})})}):e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-6 space-y-6 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-[color:var(--c-primary)]/5 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-[color:var(--c-success)]/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),e.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[color:var(--c-text)]",children:"داشبورد معیارها"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)] mt-1.5",children:"تحلیل جامع عملکرد و آمار سیستم"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:i,onChange:l=>x(l.target.value),disabled:u,className:"px-3 py-2 border border-[color:var(--c-border)] rounded-lg bg-[color:var(--c-surface)] text-[color:var(--c-text)] focus:outline-none focus:ring-2 focus:ring-[color:var(--c-primary)] disabled:opacity-50",children:[e.jsx("option",{value:"1h",children:"1 ساعت"}),e.jsx("option",{value:"24h",children:"24 ساعت"}),e.jsx("option",{value:"7d",children:"7 روز"}),e.jsx("option",{value:"30d",children:"30 روز"})]}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(E,{className:`w-5 h-5 ${u?"animate-spin":""}`}),onClick:c,disabled:u,children:"بروزرسانی"}),e.jsx(p,{variant:"ghost",size:"sm",icon:e.jsx(q,{className:"w-5 h-5"}),onClick:N,disabled:u,children:"صادرات"})]})]}),e.jsxs("div",{className:"relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{variant:"elevated",className:"group hover:shadow-[var(--shadow-2)] transition-all duration-300",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[color:var(--c-text-muted)]",children:"کل درخواست‌ها"}),e.jsx("p",{className:"text-3xl font-bold text-[color:var(--c-text)]",children:t(m.totalRequests).toLocaleString("fa-IR")}),e.jsxs("p",{className:"text-sm text-[color:var(--c-success)] flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),"+12.5%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[color:var(--c-primary)]/10 flex items-center justify-center",children:e.jsx(K,{className:"w-6 h-6 text-[color:var(--c-primary)]"})})]})})}),e.jsx(y,{variant:"elevated",className:"group hover:shadow-[var(--shadow-2)] transition-all duration-300",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[color:var(--c-text-muted)]",children:"میانگین زمان پاسخ"}),e.jsxs("p",{className:"text-3xl font-bold text-[color:var(--c-text)]",children:[(t(m.avgResponseTimeMs)/1e3).toFixed(1),"s"]}),e.jsxs("p",{className:"text-sm text-[color:var(--c-success)] flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),"-8.3%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[color:var(--c-success)]/10 flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-[color:var(--c-success)]"})})]})})}),e.jsx(y,{variant:"elevated",className:"group hover:shadow-[var(--shadow-2)] transition-all duration-300",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[color:var(--c-text-muted)]",children:"کاربران فعال"}),e.jsx("p",{className:"text-3xl font-bold text-[color:var(--c-text)]",children:Math.floor(Math.random()*100)+50}),e.jsxs("p",{className:"text-sm text-[color:var(--c-success)] flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),"+5.2%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[color:var(--c-info)]/10 flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-[color:var(--c-info)]"})})]})})}),e.jsx(y,{variant:"elevated",className:"group hover:shadow-[var(--shadow-2)] transition-all duration-300",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[color:var(--c-text-muted)]",children:"نرخ خطا"}),e.jsxs("p",{className:"text-3xl font-bold text-[color:var(--c-text)]",children:[t(m.errorRate).toFixed(1),"%"]}),e.jsxs("p",{className:"text-sm text-[color:var(--c-success)] flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),"-0.3%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[color:var(--c-warning)]/10 flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-[color:var(--c-warning)]"})})]})})})]}),e.jsxs("div",{className:"relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{variant:"elevated",children:[e.jsxs(z,{children:[e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:"درخواست‌ها در طول زمان"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)]",children:"تعداد درخواست‌ها در 24 ساعت گذشته"})]}),e.jsxs(w,{children:[e.jsx(le,{data:n.requests.map(l=>({timestamp:t(l.timestamp),count:t(l.value)})),height:200}),n.requests.length>0&&e.jsxs("div",{className:"mt-4 flex justify-between text-xs text-[color:var(--c-text-muted)]",children:[e.jsx("span",{children:I(n.requests[0].timestamp)}),e.jsx("span",{children:I(n.requests[n.requests.length-1].timestamp)})]})]})]}),e.jsxs(y,{variant:"elevated",children:[e.jsxs(z,{children:[e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:"زمان پاسخ"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)]",children:"میانگین زمان پاسخ در میلی‌ثانیه"})]}),e.jsxs(w,{children:[e.jsx(le,{data:n.responseTime.map(l=>({timestamp:t(l.timestamp),count:t(l.value)})),height:200}),n.responseTime.length>0&&e.jsxs("div",{className:"mt-4 flex justify-between text-xs text-[color:var(--c-text-muted)]",children:[e.jsx("span",{children:I(n.responseTime[0].timestamp)}),e.jsx("span",{children:I(n.responseTime[n.responseTime.length-1].timestamp)})]})]})]})]}),e.jsxs(y,{variant:"elevated",className:"relative z-10",children:[e.jsxs(z,{children:[e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:"تجزیه مدل‌ها"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)]",children:"آمار استفاده از مدل‌های مختلف"})]}),e.jsx(w,{children:f.length===0?e.jsx("p",{className:"text-center text-[color:var(--c-text-muted)] py-8",children:"هیچ داده‌ای برای نمایش وجود ندارد"}):e.jsx("div",{className:"space-y-4",children:f.map(l=>{const b=t(l.requests),a=G>0?(b/G*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-[color:var(--c-surface)] border border-[color:var(--c-border)] rounded-lg hover:bg-[color:var(--c-surface-hover)] transition-colors",children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-gradient-to-r ${l.color}`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-[color:var(--c-text)]",children:l.model}),e.jsxs(A,{variant:"secondary",children:[b.toLocaleString("fa-IR")," درخواست"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"زمان پاسخ:"}),e.jsxs("span",{className:"font-medium text-[color:var(--c-text)] ml-2",children:[t(l.avgResponseTime),"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"نرخ موفقیت:"}),e.jsxs("span",{className:"font-medium text-[color:var(--c-success)] ml-2",children:[t(l.successRate),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[color:var(--c-text-muted)]",children:"سهم:"}),e.jsxs("span",{className:"font-medium text-[color:var(--c-text)] ml-2",children:[a,"%"]})]})]})]})]},l.model)})})})]}),e.jsxs(y,{variant:"elevated",className:"relative z-10",children:[e.jsxs(z,{children:[e.jsx("h3",{className:"text-lg font-semibold text-[color:var(--c-text)]",children:"صدک‌های زمان پاسخ"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)]",children:"توزیع زمان پاسخ در صدک‌های مختلف"})]}),e.jsx(w,{children:j.length===0?e.jsx("p",{className:"text-center text-[color:var(--c-text-muted)] py-8",children:"هیچ داده‌ای برای نمایش وجود ندارد"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:j.map(l=>e.jsxs("div",{className:"text-center p-4 bg-[color:var(--c-surface)] border border-[color:var(--c-border)] rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:`text-2xl font-bold ${l.color}`,children:[t(l.value),"ms"]}),e.jsx("div",{className:"text-sm text-[color:var(--c-text-muted)]",children:l.percentile})]},l.percentile))})})]})]})}function as(){const[i,x]=d.useState(!1),r=[{id:"refresh",icon:"refresh",label:"به‌روزرسانی",onClick:async()=>{x(!0),await new Promise(n=>setTimeout(n,1e3)),x(!1)},disabled:i},{id:"new-training",icon:"plus",label:"آموزش جدید",onClick:()=>console.log("New training"),variant:"primary"},{id:"checkpoints",icon:"save",label:"چک‌پوینت‌ها",onClick:()=>console.log("Checkpoints")}];return e.jsxs(Re.div,{...Se,className:"container-padding",children:[e.jsxs("div",{className:"flex-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-h1 mb-2 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex-center",children:e.jsx(W.cpu,{className:"w-6 h-6 text-primary"})}),"استودیو آموزش"]}),e.jsx("p",{className:"text-body text-muted-foreground",children:"آموزش مدل‌ها و بررسی معیارهای عملکرد"})]}),e.jsx(ye,{actions:r})]}),e.jsxs(we,{defaultValue:"train",children:[e.jsxs(ke,{className:"mb-6",children:[e.jsxs(re,{value:"train",children:[e.jsx(W.cpu,{className:"w-4 h-4 mr-2"}),"آموزش مدل"]}),e.jsxs(re,{value:"performance",children:[e.jsx(W.chart,{className:"w-4 h-4 mr-2"}),"عملکرد و معیارها"]})]}),e.jsx(ce,{value:"train",children:e.jsx(Pe,{})}),e.jsx(ce,{value:"performance",children:e.jsx(Oe,{})})]})]})}export{as as default};
