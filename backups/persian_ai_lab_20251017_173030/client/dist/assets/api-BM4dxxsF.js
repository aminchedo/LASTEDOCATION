import{A as i}from"./auth.service-DTA6mi50.js";const f="http://localhost:3001";function y(){return u}class p{isRefreshing=!1;refreshQueue=[];async makeRequest(t,e={}){const{skipAuth:s=!1,...c}=e,n={"Content-Type":"application/json",...c.headers};if(!s){const r=i.getToken();r&&(n.Authorization=`Bearer ${r}`)}const a=await fetch(`${f}${t}`,{...c,headers:n});if(a.status===401&&!s){if(this.isRefreshing)return new Promise(r=>{this.refreshQueue.push(h=>{n.Authorization=`Bearer ${h}`,r(this.makeRequest(t,{...e,skipAuth:!0}))})});this.isRefreshing=!0;try{if(await i.refreshAuth())return this.refreshQueue.forEach(h=>h(i.getToken())),this.refreshQueue=[],n.Authorization=`Bearer ${i.getToken()}`,this.makeRequest(t,{...e,skipAuth:!0});throw i.logout(),new Error("Authentication failed")}catch(r){throw i.logout(),r}finally{this.isRefreshing=!1}}if(!a.ok){const r=await a.json().catch(()=>({}));throw new Error(r.message||`API Error: ${a.status} ${a.statusText}`)}return await a.json()}async get(t,e){return this.makeRequest(t,{...e,method:"GET"})}async post(t,e,s){return this.makeRequest(t,{...s,method:"POST",body:e?JSON.stringify(e):void 0})}async put(t,e,s){return this.makeRequest(t,{...s,method:"PUT",body:e?JSON.stringify(e):void 0})}async delete(t,e){return this.makeRequest(t,{...e,method:"DELETE"})}async patch(t,e,s){return this.makeRequest(t,{...s,method:"PATCH",body:e?JSON.stringify(e):void 0})}}const u=new p;async function d(o,t){return(await u.get(o,t)).data}async function k(o,t,e){return(await u.post(o,t,e)).data}export{k as a,d as b,u as c,y as g};
