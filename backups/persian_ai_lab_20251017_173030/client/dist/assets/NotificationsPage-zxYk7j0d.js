import{j as e,m as B,I as k,B as d,i as C,l as M,b as f,d as j,n as S,C as $,o as T,E as D,X as F,z as o}from"./index-Br5p3c61.js";import{b as h,c as R}from"./react-vendor-CHIk2tMd.js";import{B as L}from"./badge-DlDO3Hl1.js";import{s as P}from"./index-Bm_8qgMr.js";import{m as G}from"./proxy-qrGj2Bpm.js";import{g as i}from"./api-BM4dxxsF.js";import{C as H}from"./circle-check-big-BW1H2Pf2.js";import"./auth.service-DTA6mi50.js";function O({icon:l="database",title:c,description:a,action:n,className:u,illustration:v,size:b="md"}){const x=k[l];return e.jsxs(G.div,{...P,className:B("flex-center flex-col py-12 px-4 text-center",u),children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex-center mb-4",children:e.jsx(x,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-h4 mb-2",children:c}),a&&e.jsx("p",{className:"text-body text-muted-foreground max-w-md mb-6",children:a}),n&&e.jsxs(d,{onClick:n.onClick,variant:"default",children:[e.jsx(k.plus,{className:"w-4 h-4 mr-2"}),n.label]})]})}const U={info:{icon:T,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-100 dark:bg-blue-900/30",badge:"default"},success:{icon:H,color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30",badge:"success"},warning:{icon:$,color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-100 dark:bg-yellow-900/30",badge:"default"},error:{icon:$,color:"text-red-600 dark:text-red-400",bg:"bg-red-100 dark:bg-red-900/30",badge:"error"}};function W(){const[l,c]=h.useState([]),[a,n]=h.useState("all"),[u,v]=h.useState(!0),b=R();h.useEffect(()=>{x();const s=setInterval(x,5e3);return()=>clearInterval(s)},[a]);const x=async()=>{try{const s=await i().get(`/api/notifications${a==="unread"?"?unread=true":""}`);s.data.success&&c(s.data.data||[])}catch(s){console.error("Failed to load notifications:",s)}finally{v(!1)}},N=async s=>{try{await i().post(`/api/notifications/${s}/read`),c(t=>t.map(r=>r.id===s?{...r,read:!0}:r))}catch{o.error("خطا در علامت‌گذاری اعلان")}},I=async()=>{try{await i().post("/api/notifications/read-all"),c(s=>s.map(t=>({...t,read:!0}))),o.success("همه اعلان‌ها خوانده شدند")}catch{o.error("خطا در علامت‌گذاری همه اعلان‌ها")}},z=async s=>{try{await i().delete(`/api/notifications/${s}`),c(t=>t.filter(r=>r.id!==s)),o.success("اعلان حذف شد")}catch{o.error("خطا در حذف اعلان")}},E=async()=>{try{await i().delete("/api/notifications"),c([]),o.success("همه اعلان‌ها پاک شدند")}catch{o.error("خطا در پاک کردن اعلان‌ها")}},m=l.filter(s=>!s.read).length,A=s=>{const t=new Date(s),g=new Date().getTime()-t.getTime(),p=Math.floor(g/6e4),y=Math.floor(g/36e5),w=Math.floor(g/864e5);return p<1?"همین الان":p<60?`${p} دقیقه پیش`:y<24?`${y} ساعت پیش`:w<7?`${w} روز پیش`:t.toLocaleDateString("fa-IR")};return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[color:var(--c-text)]",children:"اعلان‌ها"}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)] mt-1.5",children:m>0?`${m} اعلان خوانده نشده`:"همه اعلان‌ها خوانده شده"})]}),e.jsx("div",{className:"flex gap-2",children:l.length>0&&e.jsxs(e.Fragment,{children:[m>0&&e.jsx(d,{variant:"ghost",size:"sm",icon:e.jsx(C,{className:"w-4 h-4"}),onClick:I,children:"خواندن همه"}),e.jsx(d,{variant:"ghost",size:"sm",icon:e.jsx(M,{className:"w-4 h-4"}),onClick:E,children:"پاک کردن همه"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:a==="all"?"primary":"ghost",size:"sm",onClick:()=>n("all"),children:["همه (",l.length,")"]}),e.jsxs(d,{variant:a==="unread"?"primary":"ghost",size:"sm",onClick:()=>n("unread"),children:["خوانده نشده (",m,")"]})]}),u?e.jsx(f,{variant:"elevated",children:e.jsxs(j,{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-4 text-[color:var(--c-text-muted)] animate-pulse"}),e.jsx("p",{className:"text-[color:var(--c-text-muted)]",children:"در حال بارگذاری..."})]})}):l.length===0?e.jsx(f,{variant:"elevated",children:e.jsx(j,{children:e.jsx(O,{icon:"bell",title:a==="unread"?"اعلان خوانده نشده‌ای وجود ندارد":"هیچ اعلانی وجود ندارد",description:a==="unread"?"همه اعلان‌های شما خوانده شده است":"زمانی که رویدادی رخ دهد، در اینجا مطلع خواهید شد",illustration:"success",size:"lg"})})}):e.jsx("div",{className:"space-y-3",children:l.map(s=>{const t=U[s.type],r=t.icon;return e.jsx(f,{variant:"elevated",className:`group transition-all duration-300 ${s.read?"":"border-l-4 border-l-[color:var(--c-primary)] shadow-md"}`,children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${t.bg} flex items-center justify-center flex-shrink-0`,children:e.jsx(r,{className:`w-5 h-5 ${t.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-[color:var(--c-text)]",children:s.title}),!s.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-[color:var(--c-primary)] animate-pulse"})]}),e.jsx(L,{variant:t.badge,className:"flex-shrink-0",children:s.source||s.type})]}),e.jsx("p",{className:"text-sm text-[color:var(--c-text-muted)] mb-2",children:s.message}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-[color:var(--c-text-muted)]",children:[e.jsx("span",{children:A(s.timestamp)}),s.action&&e.jsxs("button",{onClick:()=>{N(s.id),b(s.action.url)},className:"flex items-center gap-1 text-[color:var(--c-primary)] hover:underline",children:[e.jsx("span",{children:s.action.label}),e.jsx(D,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[!s.read&&e.jsx("button",{onClick:()=>N(s.id),className:"p-2 rounded-lg hover:bg-[color:var(--c-bg-secondary)] text-[color:var(--c-text-muted)] hover:text-[color:var(--c-text)] transition-colors",title:"علامت به عنوان خوانده شده",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(s.id),className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-[color:var(--c-text-muted)] hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"حذف",children:e.jsx(F,{className:"w-4 h-4"})})]})]})})},s.id)})})]})}export{W as NotificationsPage,W as default};
